rule1:
  ruleId: rule1
  host: lightapi.net
  ruleType: generic
  visibility: public
  description: first rule for unit test
  conditions:
    - conditionId: cid1
      variableName: ClassA
      propertyPath: Bobject.Cobject.Cint
      operatorCode: EQ
      joinCode: AND
      index: 0
      conditionValues:
        - conditionValueId: cv1
          conditionValue: 6
  actions:
    - actionId: act1
      actionClassName: com.networknt.rule.ValidationAction

role-based-auth:
  ruleId: role-based-auth
  host: lightapi.net
  ruleType: request-access
  visibility: public
  description: Role-based authorization rule for a particuler service with parameters different per endpoint.
  conditions:
    - conditionId: allow-role
      variableName: auditInfo
      propertyPath: subject_claims.ClaimsMap.roles
      operatorCode: NNIL
      joinCode: OR
      index: 1
  actions:
    - actionId: match-role
      actionClassName: com.networknt.rule.FineGrainedAuthAction
      actionValues:
        - actionValueId: roles
          value: $roles

role-based-auth-skip-cc:
  ruleId: role-based-auth-skip-cc
  host: lightapi.net
  ruleType: request-access
  visibility: public
  description: Role-based authorization rule for a particuler service with parameters different per endpoint. Client Credentials token is allowed without role in claims
  conditions:
    - conditionId: allow-cc
      variableName: auditInfo
      propertyPath: subject_claims.ClaimsMap.user_id
      operatorCode: NIL
      joinCode: OR
      index: 1
    - conditionId: allow-role
      variableName: auditInfo
      propertyPath: subject_claims.ClaimsMap.roles
      operatorCode: NNIL
      joinCode: OR
      index: 2
  actions:
    - actionId: match-role
      actionClassName: com.networknt.rule.FineGrainedAuthAction
      actionValues:
        - actionValueId: roles
          value: $roles

cc-group-role-auth:
  ruleId: cc-group-role-auth
  host: lightapi.net
  ruleType: request-access
  visibility: public
  description: Role-based authorization rule for account service and allow cc token and transform group to role.
  conditions:
    - conditionId: allow-cc
      variableName: auditInfo
      propertyPath: subject_claims.ClaimsMap.user_id
      operatorCode: NIL
      joinCode: OR
      index: 1
    - conditionId: manager
      variableName: auditInfo
      propertyPath: subject_claims.ClaimsMap.groups
      operatorCode: CS
      joinCode: OR
      index: 2
      conditionValues:
        - conditionValueId: manager
          conditionValue: admin
    - conditionId: teller
      variableName: auditInfo
      propertyPath: subject_claims.ClaimsMap.groups
      operatorCode: CS
      joinCode: OR
      index: 3
      conditionValues:
        - conditionValueId: teller
          conditionValue: frontOffice
    - conditionId: allow-role-jwt
      variableName: auditInfo
      propertyPath: subject_claims.ClaimsMap.roles
      operatorCode: NNIL
      joinCode: OR
      index: 4
  actions:
    - actionId: match-role
      actionClassName: com.networknt.rule.FineGrainedAuthAction
      actionValues:
        - actionValueId: roles
          value: $roles

ccsid-group-role-auth:
  ruleId: ccsid-group-role-auth
  host: lightapi.net
  ruleType: request-access
  visibility: public
  description: Role-based authorization rule for account service and allow cc token with sid claim and transform group to role. This is for the controller and config server.
  conditions:
    - conditionId: allow-cc
      variableName: auditInfo
      propertyPath: subject_claims.ClaimsMap.user_id
      operatorCode: NIL
      joinCode: AND
      index: 1
    - conditionId: has-sid
      variableName: auditInfo
      propertyPath: subject_claims.ClaimsMap.sid
      operatorCode: NNIL
      joinCode: AND
      index: 2
    - conditionId: manager
      variableName: auditInfo
      propertyPath: subject_claims.ClaimsMap.groups
      operatorCode: CS
      joinCode: OR
      index: 3
      conditionValues:
        - conditionValueId: manager
          conditionValue: admin
    - conditionId: teller
      variableName: auditInfo
      propertyPath: subject_claims.ClaimsMap.groups
      operatorCode: CS
      joinCode: OR
      index: 4
      conditionValues:
        - conditionValueId: teller
          conditionValue: frontOffice
    - conditionId: allow-role-jwt
      variableName: auditInfo
      propertyPath: subject_claims.ClaimsMap.roles
      operatorCode: NNIL
      joinCode: OR
      index: 5
  actions:
    - actionId: match-role
      actionClassName: com.networknt.rule.FineGrainedAuthAction
      actionValues:
        - actionValueId: roles
          value: $roles

petstore-group-role-transform:
  ruleId: petstore-group-role-transform
  host: lightapi.net
  ruleType: request-access
  visibility: public
  description: A rule to transform a list of Active Directory groups to a list of roles for petstore API
  conditions:
    - conditionId: manager
      variableName: groups
      operatorCode: CS
      joinCode: OR
      index: 1
      conditionValues:
        - conditionValueId: manager
          conditionValue: admin
    - conditionId: teller
      variableName: groups
      operatorCode: CS
      joinCode: OR
      index: 2
      conditionValues:
        - conditionValueId: teller
          conditionValue: frontOffice
